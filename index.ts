import {VK} from 'vk-io';

require('dotenv').config()
const vk = new VK({
    token: process.env.vk_token
});

let index
//Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð¿Ð¾ÑÑ‚Ð¾Ð²
async function getPosts() {
    const posts = await vk.api.wall.get({
        domain: "somecompanykamui",
        count: 100,
    })
    posts.items.filter(i => {
        index = i.text.indexOf(' Ð´Ð¾ ')
        if (index) {
            index += 4;
        }
    })
    return posts;
}
//Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð¿Ð°Ñ€ÑÐ¸Ð½Ð³Ð° Ð°Ð´Ñ€ÐµÑÐ°
let adress;

async function getAdress() {
    adress = await vk.api.groups.getAddresses({
        group_id: 204425110,
        filter: "all"
    })
    return adress;
}

//Ñ€Ð°Ð±Ð¾Ñ‚Ð° Ñ Telegraf
import {Telegraf} from 'telegraf'
import {text} from "telegraf/typings/button";

const bot = new Telegraf(process.env.bot_token)
bot.start((ctx) => {
    ctx.reply(`ÐŸÑ€Ð¸Ð²ÐµÑ‚ ${ctx.message.from.first_name}, Ñ Ñ‡Ð°Ñ‚-Ð±Ð¾Ñ‚, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð°ÐºÑ†Ð¸Ð¸ Some Company, Ð´Ð»Ñ Ñ‚Ð¾Ð³Ð¾ Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ²Ð¸Ð´ÐµÑ‚ÑŒ Ð²ÑÐµ Ð¼Ð¾Ð¸ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ - Ð½Ð°Ð¿Ð¸ÑˆÐ¸ Ð¼Ð½Ðµ /help`)
})

bot.command('address', async (ctx) => {
    let adress = await getAdress()
    ctx.reply('ðŸ¢Ð³.ÐœÐ¾ÑÐºÐ²Ð° '+ adress.items[0].address + '\nðŸ•“Ð§Ð°ÑÑ‹ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹: 10:00-19:00')
})

bot.command('get', async (ctx) => {
    let postText;
    let posts = await getPosts();
    posts.items.forEach(i => {


        const dateStart = new Date(i.date * 1000)
        if (Date.parse(i.text.substring(index)) > Date.now()) {
            postText = `ðŸ”¥${i.text.substring(0)}\nÐÐ°Ñ‡Ð°Ð»Ð¾ ÑÐºÐ¸Ð´ÐºÐ¸: ${dateStart}âš¡ï¸`;
            ctx.reply(postText)
        }
    })
})

bot.help(async (ctx) => {
    const helpText = 'ÐŸÐ¾ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ°Ð¼ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ ÑÐµÑ€Ð²Ð¸ÑÐ° Ð¸ Ñ‚ÐµÑ…Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¸ Ð½Ð°Ð¿Ñ€Ð°Ð²Ð»ÑÐ¹Ñ‚Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŽ @kamuikori.\n' +
        'Ð‘ÑƒÐ´ÐµÐ¼ Ñ€Ð°Ð´Ñ‹ Ð²Ð°ÑˆÐ¸Ð¼ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸ÑÐ¼ Ð¸ Ð¿Ð¾Ð¶ÐµÐ»Ð°Ð½Ð¸ÑÐ¼!\n'+
        'â„¹ï¸Ð¡Ð¿Ñ€Ð°Ð²ÐºÐ° Ð¿Ð¾ Ð¼Ð¾Ð¸Ð¼ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°Ð¼:\n'+
        '/start - ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð´Ð»Ñ Ð½Ð°Ñ‡Ð°Ð»Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ ÑÐ¾ Ð¼Ð½Ð¾Ð¹ âœ… \n' +
        '/get - Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð°ÐºÑ†Ð¸Ð¸ Ð¸ ÑÐºÐ¸Ð´ÐºÐ¸ðŸ”¥\n'+
        '/faq - Ð¿Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹ Ð½Ð° Ñ‡Ð°ÑÑ‚Ð¾ Ð·Ð°Ð´Ð°Ð²Ð°ÐµÐ¼Ñ‹Ðµ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹â“\n'+
        '/address - Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð°Ð´Ñ€ÐµÑ Ð½Ð°ÑˆÐµÐ¹ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸ðŸ¢\n'+
        '/help - Ð’Ñ‹ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÐµÑÑŒ Ð·Ð´ÐµÑÑŒðŸ˜Š'
    ctx.reply(helpText)
})

bot.command('faq', async (ctx)=>{
    let text = 'ðŸ’­Ð’Ñ‹ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÐµÑÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð² ÐœÐ¾ÑÐºÐ²Ðµ?\n'+
        'âœ…Ð”Ð°, Ð½Ð¾ Ð¼Ñ‹ Ð¼Ð¾Ð¶ÐµÐ¼ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ñ‚Ð¾Ð²Ð°Ñ€ Ð² Ð»ÑŽÐ±ÑƒÑŽ Ñ‚Ð¾Ñ‡ÐºÑƒ Ð¼Ð¸Ñ€Ð°!\n'+
        'ðŸ’­Ð¡ÐºÐ¸Ð´ÐºÐ¸ Ñ€Ð°ÑÐ¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ Ð¸ Ð½Ð° Ñ‚Ð¾Ð²Ð°Ñ€ Ð¿Ñ€Ð¸ Ð·Ð°ÐºÐ°Ð·Ðµ Ð½Ðµ Ð¸Ð· ÐœÐ¾ÑÐºÐ²Ñ‹?\n'+
        'âœ…Ð”Ð°\n'+
        'ðŸ’­ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ Ð’Ñ‹ Ñ‚Ð°Ðº Ñ‡Ð°ÑÑ‚Ð¾ Ð¼ÐµÐ½ÑÐµÑ‚Ðµ Ð°Ð´Ñ€ÐµÑ?\n'+
        'âœ…Ð’ ÑÐ²ÑÐ·Ð¸ Ñ ÑÐ¿Ð¸Ð´ÐµÐ¼Ð¸Ð¾Ð»Ð¸Ð³Ñ‡ÐµÑÐºÐ¾Ð¹ ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ð¸ÐµÐ¹ Ð² ÑÑ‚Ñ€Ð°Ð½Ðµ ÑÐ»Ð¾Ð¶Ð½Ð¾ Ð½Ð°Ð¹Ñ‚Ð¸ Ð´Ð¾Ð»Ð³Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ð°Ñ€ÐµÐ½Ð´Ñƒ Ð¿Ð¾Ð¼ÐµÑ‰ÐµÐ½Ð¸Ñ.\n'+
        'ðŸ’­Ð—Ð°Ñ‡ÐµÐ¼ Ð½ÑƒÐ¶ÐµÐ½ ÑÑ‚Ð¾Ñ‚ Ð±Ð¾Ñ‚?\n'+
        'âœ…Ð”Ð°Ð½Ð½Ñ‹Ð¹ Ð±Ð¾Ñ‚ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð’Ð°Ð¼ ÑƒÐ·Ð½Ð°Ñ‚ÑŒ Ð¾ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ñ… ÑÐºÐ¸Ð´ÐºÐ°Ñ…/Ð°ÐºÑ†Ð¸ÑÑ… Ð½Ð°ÑˆÐµÐ¹ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸, Ñ‡Ñ‚Ð¾ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾ Ð´Ð»Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð² Ð½Ðµ Ð¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‰Ð¸Ñ…ÑÑ Ð’ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ðµ.\n'+
        'ðŸ’­ÐšÐ°Ðº Ñ‡Ð°ÑÑ‚Ð¾ Ð¿Ñ€Ð¾Ð²Ð¾Ð´ÑÑ‚ÑÑ Ð°ÐºÑ†Ð¸Ð¸?\n'+
        'âœ…ÐœÑ‹ ÑƒÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÐ¼ Ð°ÐºÑ†Ð¸Ð¸ Ð¾Ñ‡ÐµÐ½ÑŒ Ñ‡Ð°ÑÑ‚Ð¾, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÑÑ‚Ð¾Ð³Ð¾ Ñ‡Ð°Ñ‚-Ð±Ð¾Ñ‚Ð° Ð´Ð»Ñ Ñ‚Ð¾Ð³Ð¾ Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾ÑÑ‚Ð°Ð²Ð°Ñ‚ÑŒÑÑ Ð² ÐºÑƒÑ€ÑÐµ!\n'+
        'ðŸ’­ÐšÐ°Ðº Ð´Ð¾Ð»Ð³Ð¾ Ð’Ñ‹ Ð·Ð°Ð½Ð¸Ð¼Ð°ÐµÑ‚ÐµÑÑŒ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð°Ð¼Ð¸?\n'+
        'âœ…ÐœÑ‹ Ð·Ð°Ð½Ð¸Ð¼Ð°ÐµÐ¼ÑÑ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð°Ð¼Ð¸ Ñ 2020 Ð³Ð¾Ð´Ð°\n'+
        'ðŸ’­Ð•ÑÑ‚ÑŒ Ð»Ð¸ Ñƒ Ð²Ð°Ñ ÑÐ°Ð¹Ñ‚?\n'+
        'âœ…ÐÐµÑ‚, ÑÐ°Ð¹Ñ‚ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑÑ Ð½Ð° ÑÑ‚Ð°Ð´Ð¸Ð¸ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸, Ð½Ð¾ Ð’Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¾Ð·Ð½Ð°ÐºÐ¾Ð¼Ð¸Ñ‚ÑŒÑÑ ÑÐ¾ Ð²ÑÐµÐ¼Ð¸ Ñ‚Ð¾Ð²Ð°Ñ€Ð°Ð¼Ð¸ Ð² Ð½Ð°ÑˆÐµÐ¹ Ð³Ñ€ÑƒÐ¿Ð¿Ðµ Ð’ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ðµ '+ 'https://vk.com/somecompanykamui'
    ctx.reply(text)
})

bot.command('contacts', async (ctx)=>{
    let text = 'â˜Žï¸Ð¢ÐµÐ»ÐµÑ„Ð¾Ð½: +79991233344\nâœ‰ï¸E-mail: somecompany@yandex.ru\nðŸ“«Telegram: @kamuikori '
    ctx.reply(text)
})

let textDontKnow = "Ð¯ Ð²Ð°Ñ Ð½Ðµ Ð¿Ð¾Ð½ÑÐ», Ð¿Ð¾Ð¶Ð°Ð»ÑƒÐ¹ÑÑ‚Ð°, Ð²Ð¾ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚ÐµÑÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°Ð¼Ð¸.\nÐ’ÑÐµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð¸ Ð¸Ñ… Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð½Ð°Ð¿Ð¸ÑÐ°Ð² Ð¼Ð½Ðµ /help â¬‡ï¸";
bot.on(("text"), (ctx =>{
    ctx.reply(textDontKnow)
}))
bot.on(("sticker"), (ctx =>{
    ctx.reply(textDontKnow)
}))

bot.launch()